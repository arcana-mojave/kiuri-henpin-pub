(()=>{const t=60,s=1024,e=.5,i="bg",a="bg_naharuya",o="soyo",n="soyo_moving",d="mutsumi",r="mutsumi_launching",h="kyuri",u="nasu",l="choco",c="life",m="speed",y="large",p="fever",f="suka",g="return",b="explotion",v="sound_return",w="sound_landing",x="sound_buff",S="sound_launch",M="sound_miss",I="sound_naharuya",R="sound_start",k="sound_extend",C={0:.7,1:.25,2:.05},B={0:.94,1:.03,2:.02,3:.01};let O,D,F,_,j,T,W,G,L,N,P,U,$,z,E,K,A,H,V,X,Y,q,J,Q,Z,tt,st,et,it,at,ot,nt,dt,rt,ht=!1,ut=!1,lt=!1,ct=!1;function mt(t){switch(t){case m:case y:case p:return!0;default:return!1}}function yt(){return ot>0&&nt>0&&dt>0}class pt extends Phaser.Scene{constructor(){super(),rt=this}preload(){this.initialize(),this.load.image(i,"assets/bg.png"),this.load.image(a,"assets/bg_naharuya.png"),this.load.image(h,"assets/objects/kyuri.png"),this.load.image(u,"assets/objects/nasu.png"),this.load.image(l,"assets/objects/choco.png"),this.load.image(c,"assets/objects/life.png"),this.load.image(m,"assets/objects/speed.png"),this.load.image(y,"assets/objects/large.png"),this.load.image(p,"assets/objects/fever.png"),this.load.image(g,"assets/effects/return.png"),this.load.image(b,"assets/effects/explosion.png"),this.load.spritesheet(o,"assets/soyo.png",{frameWidth:192,frameHeight:288}),this.load.spritesheet(d,"assets/mutsumi.png",{frameWidth:225,frameHeight:288}),this.load.audio(v,["assets/sounds/return.mp3"]),this.load.audio(w,["assets/sounds/landing.mp3"]),this.load.audio(x,["assets/sounds/buff.mp3"]),this.load.audio(S,["assets/sounds/launch.mp3"]),this.load.audio(M,["assets/sounds/miss.mp3"]),this.load.audio(I,["assets/sounds/naharuya.mp3"]),this.load.audio(R,["assets/sounds/start.mp3"]),this.load.audio(k,["assets/sounds/extend.mp3"])}create(){A=this.add.image(512,288,i),H=this.add.sprite(112,416,d,0),H.anims.create({key:r,duration:500,frames:this.anims.generateFrameNumbers(d,{start:0,end:2}),repeat:1}),V=this.physics.add.sprite(928,288,o,0),V.scaleX=e,V.scaleY=e,V.body.setGravity(0,-200),V.setCollideWorldBounds(!0),V.setBounce(0),V.anims.create({key:n,frameRate:3,frames:this.anims.generateFrameNumbers(o,{start:2,end:3}),repeat:-1}),F=this.add.text(512,16,`SCORE: ${U}`,{fontSize:32}),this.viewLife(),O=this.add.text(512,288,"Return Cucumbers",{fontSize:32}).setOrigin(.5).setPadding(10).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.startGame(!1))).on("pointerover",(()=>O.setStyle({fill:"#f39c12"}))).on("pointerout",(()=>O.setStyle({fill:"#FFF"}))),D=this.add.text(512,320,"<Hit space or Tap> ver.1.00",{fontSize:16}).setOrigin(.5).setPadding(10).setStyle({backgroundColor:"#111"}),this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).on("down",(()=>this.startGame(!0))),q=this.sound.add(v),J=this.sound.add(w),Q=this.sound.add(x),Z=this.sound.add(S),tt=this.sound.add(M),st=this.sound.add(I),et=this.sound.add(R),it=this.sound.add(k)}update(){if(ut)if(lt)this.gameOver();else{if(yt()&&A.texture.key===i?A.setTexture(a):yt()||A.texture.key!==a||A.setTexture(i),X>0?X--:ct||V.setFrame(0),nt>0?(V.scaleX=1,V.scaleY=1):(V.scaleX=e,V.scaleY=e),ht){const t=this.input.keyboard.createCursorKeys();t.up.isDown&&(this.moveUp(),ht=!0),t.down.isDown&&(this.moveDown(),ht=!0),t.left.isDown&&(this.moveLeft(),ht=!0),t.right.isDown&&(this.moveRight(),ht=!0),ct&&t.up.isUp&&t.left.isUp&&t.right.isUp&&t.down.isUp&&(V.anims.stop(),ct=!1)}else{const t=this.input.activePointer;t.y<288&&t.y>=0&&this.moveUp(),t.y>288&&t.y<=576&&this.moveDown(),t.x<768&&t.x>=0&&this.moveLeft(),t.x>768&&t.x<=s&&this.moveRight(),ct&&!t.isDown&&(V.anims.stop(),ct=!1)}if(V.x<512&&(V.x=512),_++,30===_||_===t)if(j+=1,_=0,this.getRandomInt(100)<L)this.coinToss()?this.throwByMutsumi(!1,!0):this.throwByMutsumi();else{const t=this.buffLottery();t!==f&&this.throwByMutsumi(t)}this.reinforcesMutsumi()&&(T-=5,W+=10,G+=-7,L+=2,L>64&&(L=64)),(j*t+_)%T==0&&this.throwByMutsumi(),Math.floor(U/1e5)-(P+1)==0&&N<6&&(P++,N++,it.play()),ot>0&&ot--,nt>0&&nt--,dt>0&&dt--,F.setText(`SCORE: ${U}`),this.viewLife(),this.viewBuff()}}initialize(){ct=!1,_=0,j=0,T=100,W=650,G=-500,L=10,N=3,P=0,U=0,$=0,z=0,E=0,K=0,ot=0,nt=0,dt=0,X=0}startGame(t){ut||et.play(),ht=t,O.setVisible(!1),D.setVisible(!1),ut=!0}gameOver(){lt=!1,ut=!1,alert(`SCORE: ${U} / TIME: ${j}s\nKyuri: ${$}, Nasu: ${z}, Choco: ${E} returned...`),this.scene.restart()}moveUp(){this.soyoMovingStartIfNeed(),V.y+=-6,V.y+=-6}moveDown(){this.soyoMovingStartIfNeed(),V.y+=6}moveLeft(){this.soyoMovingStartIfNeed(),V.x+=-6}moveRight(){this.soyoMovingStartIfNeed(),V.x+=6}reinforcesMutsumi(){const t=$+z+E;return j>0&&Math.floor(t/30)-(K+1)==0&&(K++,!0)}soyoMovingStartIfNeed(){ct||0!==X||(V.play(n),ct=!0)}viewLife(){void 0!==Y&&Y.destroy(!0,!0),Y=this.physics.add.staticGroup();for(let t=1;t<N;t++)Y.create(976-72*(t-1),528,c)}viewBuff(){if(void 0!==at&&at.destroy(!0,!0),at=this.physics.add.staticGroup(),ot>0){const s=ot/t;(s>5||s<=5&&ot%15==0)&&at.create(976,48,m)}if(nt>0){const s=nt/t;(s>5||s<=5&&nt%15==0)&&at.create(976,128,y)}if(dt>0){const s=dt/t;(s>5||s<=5&&dt%15==0)&&at.create(976,208,p)}}buffLottery(){switch(this.getWeightedRandamInt(B)){case"0":default:return f;case"1":return m;case"2":return y;case"3":return p}}decideFlyingObject(){if(dt>0)return l;switch(this.getWeightedRandamInt(C)){case"0":default:return h;case"1":return u;case"2":return l}}throwByMutsumi(t,e){let i,a,o;H.play(r),i=t||this.decideFlyingObject(),e?(a=1.5*W+this.getRandomInt(30),o=200-this.getRandomInt(21)):(a=W+this.getRandomInt(30),o=G-this.getRandomInt(21)),this.coinToss()&&(o*=-1);const n=this.physics.add.sprite(112+this.getRandomInt(224),416-this.getRandomInt(288),i);n.setVelocity(a,o),n.setCollideWorldBounds(!0),n.setBounce(1.9),n.body.onWorldBounds=!0,n.body.world.on("worldbounds",(function(t){if(t.gameObject===this&&this.x>s-this.width){const t=this.x,s=this.y;this.destroy(),mt(this.texture.key)||(N--,rt.explosion(t,s),tt.play(),0===N&&(lt=!0))}}),n),this.physics.add.overlap(V,n,this.catchBySoyo,null,this),Z.play()}coinToss(){return 0===Math.floor(2*Math.random())}getRandomInt(t){return Math.floor(Math.random()*t)}getWeightedRandamInt(t){var s,e=0,i=Math.random();for(s in t)if(i<=(e+=t[s]))return s}catchBySoyo(t,s){if(X>0)return;const e=s.texture.key;if(s.destroy(),mt(e)){switch(e){case m:ot=900;break;case y:nt=900;break;case p:dt=900}yt()?st.play():Q.play()}else{t.setFrame(1),X=10;const s=this.physics.add.sprite(t.x,t.y,e);s.setVelocity(-500,255),s.setCollideWorldBounds(!0),s.body.setGravity(0,-200),s.body.onWorldBounds=!0,s.body.world.on("worldbounds",(function(t){if(t.gameObject===this&&this.x<this.width){const t=function(t){let s;switch(t){case h:s=100,$++;break;case u:s=300,z++;break;case l:s=1e3,E++;break;default:s=100,$++}return yt()?2*s:s}(e);rt.popupScore(this.x,this.y,t),U+=t,J.play(),this.destroy()}}),s);const i=this.add.particles(1,0,g,{alpha:.3,speed:100,scale:{start:1,end:0},blendMode:"ADD"});i.startFollow(s),this.time.delayedCall(1600,(function(){i.destroy()})),q.play()}}popupScore(t,s,e){const i=t+this.getRandomInt(150),a=s-this.getRandomInt(192);rt.explosion(i,a);const o=rt.add.text(i,a,e,{fontSize:24});o.setColor("#FF0000"),o.setShadow(4,4,"#000000",4,!0,!0),rt.time.delayedCall(500,(function(){o.destroy()}))}explosion(t,s){const e=rt.add.particles(t,s,b,{alpha:.3,speed:100,scale:{start:1,end:0},blendMode:"ADD"});this.time.delayedCall(250,(function(){e.destroy()}))}}const ft={type:Phaser.AUTO,width:s,height:576,fps:{target:t,forceSetTimeOut:!0},physics:{default:"arcade",arcade:{debug:!1,gravity:{y:200}}},scene:pt};new Phaser.Game(ft)})();