(()=>{const t=60,s=1024,e="bg",i="bg_naharuya",a="soyo",o="soyo_moving",n="mutsumi",d="mutsumi_launching",r="kyuri",h="nasu",u="choco",c="life",l="speed",m="large",y="fever",p="suka",f="return",g="sound_return",b="sound_landing",v="sound_buff",w="sound_launch",x="sound_miss",M="sound_naharuya",I="sound_start",R="sound_extend",k={0:.7,1:.25,2:.05},B={0:.94,1:.03,2:.02,3:.01};let S,C,O,_,j,D,F,W,T,G,L,N,U,P,$,E,K,A,H,V,z,X,Y,q,J,Q,Z,tt,st,et,it,at,ot=!1,nt=!1,dt=!1,rt=!1;function ht(t){switch(t){case l:case m:case y:return!0;default:return!1}}function ut(){return et>0&&it>0&&at>0}class ct extends Phaser.Scene{constructor(){super()}preload(){this.initialize(),this.load.image(e,"assets/bg.png"),this.load.image(i,"assets/bg_naharuya.png"),this.load.image(r,"assets/objects/kyuri.png"),this.load.image(h,"assets/objects/nasu.png"),this.load.image(u,"assets/objects/choco.png"),this.load.image(c,"assets/objects/life.png"),this.load.image(l,"assets/objects/speed.png"),this.load.image(m,"assets/objects/large.png"),this.load.image(y,"assets/objects/fever.png"),this.load.image(f,"assets/effects/return.png"),this.load.spritesheet(a,"assets/soyo.png",{frameWidth:96,frameHeight:144}),this.load.spritesheet(n,"assets/mutsumi.png",{frameWidth:192,frameHeight:288}),this.load.audio(g,["assets/sounds/return.mp3"]),this.load.audio(b,["assets/sounds/landing.mp3"]),this.load.audio(v,["assets/sounds/buff.mp3"]),this.load.audio(w,["assets/sounds/launch.mp3"]),this.load.audio(x,["assets/sounds/miss.mp3"]),this.load.audio(M,["assets/sounds/naharuya.mp3"]),this.load.audio(I,["assets/sounds/start.mp3"]),this.load.audio(R,["assets/sounds/extend.mp3"])}create(){E=this.add.image(512,288,e),K=this.add.sprite(96,416,n,0),K.anims.create({key:d,duration:500,frames:this.anims.generateFrameNumbers(n,{start:1,end:2}),repeat:1}),A=this.physics.add.sprite(928,288,a,0),A.body.setGravity(0,-200),A.setCollideWorldBounds(!0),A.setBounce(0),A.anims.create({key:o,frameRate:3,frames:this.anims.generateFrameNumbers(a,{start:2,end:3}),repeat:-1}),C=this.add.text(682,16,`SCORE: ${L}`),this.viewLife(),S=this.add.text(512,288,"Return Cucumbers").setOrigin(.5).setPadding(10).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>this.startGame(!1))).on("pointerover",(()=>S.setStyle({fill:"#f39c12"}))).on("pointerout",(()=>S.setStyle({fill:"#FFF"}))),this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE).on("down",(()=>this.startGame(!0))),z=this.sound.add(g),X=this.sound.add(b),Y=this.sound.add(v),q=this.sound.add(w),J=this.sound.add(x),Q=this.sound.add(M),Z=this.sound.add(I),tt=this.sound.add(R)}update(){if(nt)if(dt)this.gameOver();else{if(ut()&&E.texture.key===e?E.setTexture(i):ut()||E.texture.key!==i||E.setTexture(e),H>0?H--:rt||A.setFrame(0),it>0?(A.scaleX=2,A.scaleY=2):(A.scaleX=1,A.scaleY=1),ot){const t=this.input.keyboard.createCursorKeys();t.up.isDown&&(this.moveUp(),ot=!0),t.down.isDown&&(this.moveDown(),ot=!0),t.left.isDown&&(this.moveLeft(),ot=!0),t.right.isDown&&(this.moveRight(),ot=!0),rt&&t.up.isUp&&t.left.isUp&&t.right.isUp&&t.down.isUp&&(A.anims.stop(),rt=!1)}else{const t=this.input.activePointer;t.y<288&&t.y>=0&&this.moveUp(),t.y>288&&t.y<=576&&this.moveDown(),t.x<768&&t.x>=0&&this.moveLeft(),t.x>768&&t.x<=s&&this.moveRight(),rt&&!t.isDown&&(A.anims.stop(),rt=!1)}if(A.x<512&&(A.x=512),O++,30===O||O===t)if(_+=1,O=0,this.getRandomInt(100)<W)this.coinToss()?this.throwByMutsumi(!1,!0):this.throwByMutsumi();else{const t=this.buffLottery();t!==p&&this.throwByMutsumi(t)}this.reinforcesMutsumi()&&(j-=5,D+=10,F+=-7,W+=2,W>64&&(W=64)),(_*t+O)%j==0&&this.throwByMutsumi(),Math.floor(L/1e5)-(G+1)==0&&T<6&&(G++,T++,tt.play()),et>0&&et--,it>0&&it--,at>0&&at--,C.setText(`SCORE: ${L}`),this.viewLife(),this.viewBuff()}}initialize(){rt=!1,O=0,_=0,j=100,D=650,F=-500,W=10,T=3,G=0,L=0,N=0,U=0,P=0,$=0,et=0,it=0,at=0,H=0}startGame(t){nt||Z.play(),ot=t,S.setVisible(!1),nt=!0}gameOver(){dt=!1,nt=!1,alert(`SCORE: ${L} / TIME: ${_}s\nKyuri: ${N}, Nasu: ${U}, Choco: ${P} returned...`),this.scene.restart()}moveUp(){this.soyoMovingStartIfNeed(),A.y+=-6,A.y+=et>0?-12:-6}moveDown(){this.soyoMovingStartIfNeed(),A.y+=et>0?12:6}moveLeft(){this.soyoMovingStartIfNeed(),A.x+=et>0?-12:-6}moveRight(){this.soyoMovingStartIfNeed(),A.x+=et>0?12:6}reinforcesMutsumi(){const t=N+U+P;return _>0&&Math.floor(t/30)-($+1)==0&&($++,!0)}soyoMovingStartIfNeed(){rt||0!==H||(A.play(o),rt=!0)}viewLife(){void 0!==V&&V.destroy(!0,!0),V=this.physics.add.staticGroup();for(let t=1;t<T;t++)V.create(976-72*(t-1),528,c)}viewBuff(){if(void 0!==st&&st.destroy(!0,!0),st=this.physics.add.staticGroup(),et>0){const s=et/t;(s>5||s<=5&&et%15==0)&&st.create(976,48,l)}if(it>0){const s=it/t;(s>5||s<=5&&it%15==0)&&st.create(976,128,m)}if(at>0){const s=at/t;(s>5||s<=5&&at%15==0)&&st.create(976,208,y)}}buffLottery(){switch(this.getWeightedRandamInt(B)){case"0":default:return p;case"1":return l;case"2":return m;case"3":return y}}decideFlyingObject(){if(at>0)return u;switch(this.getWeightedRandamInt(k)){case"0":default:return r;case"1":return h;case"2":return u}}throwByMutsumi(t,e){let i,a,o;K.play(d),i=t||this.decideFlyingObject(),e?(a=1.5*D+this.getRandomInt(30),o=200-this.getRandomInt(21)):(a=D+this.getRandomInt(30),o=F-this.getRandomInt(21)),this.coinToss()&&(o*=-1);const n=this.physics.add.sprite(96+this.getRandomInt(192),416-this.getRandomInt(288),i);n.setVelocity(a,o),n.setCollideWorldBounds(!0),n.setBounce(1.9),n.body.onWorldBounds=!0,n.body.world.on("worldbounds",(function(t){t.gameObject===this&&this.x>s-this.width&&(this.destroy(),ht(this.texture.key)||(T-=1,J.play(),0===T&&(dt=!0)))}),n),this.physics.add.overlap(A,n,this.catchBySoyo,null,this),q.play()}coinToss(){return 0===Math.floor(2*Math.random())}getRandomInt(t){return Math.floor(Math.random()*t)}getWeightedRandamInt(t){var s,e=0,i=Math.random();for(s in t)if(i<=(e+=t[s]))return s}catchBySoyo(t,s){if(H>0)return;const e=s.texture.key;if(s.destroy(),ht(e)){switch(e){case l:et=900;break;case m:it=900;break;case y:at=900}ut()?Q.play():Y.play()}else{t.setFrame(1),H=10;const s=this.physics.add.sprite(t.x,t.y,e);s.setVelocity(-500,255),s.setCollideWorldBounds(!0),s.body.setGravity(0,-200),s.body.onWorldBounds=!0,s.body.world.on("worldbounds",(function(t){t.gameObject===this&&this.x<this.width&&(L+=function(t){let s;switch(t){case r:s=100,N++;break;case h:s=300,U++;break;case u:s=1e3,P++;break;default:s=100,N++}return ut()?2*s:s}(e),this.destroy(),X.play())}),s);const i=this.add.particles(1,0,f,{alpha:.3,speed:100,scale:{start:1,end:0},blendMode:"ADD"});i.startFollow(s),this.time.delayedCall(2e3,(function(){i.destroy()})),z.play()}}}const lt={type:Phaser.AUTO,width:s,height:576,fps:{target:t,forceSetTimeOut:!0},physics:{default:"arcade",arcade:{debug:!1,gravity:{y:200}}},scene:ct};new Phaser.Game(lt)})();